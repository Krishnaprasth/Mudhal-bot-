[...full code will be pasted manually here if needed...]